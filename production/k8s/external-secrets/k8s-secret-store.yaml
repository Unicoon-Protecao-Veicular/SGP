apiVersion: external-secrets.io/v1beta1
kind: ClusterSecretStore
metadata:
  name: kubernetes-backend
spec:
  provider:
    kubernetes:
      # 1. O URL do servidor da API do Kubernetes dentro do cluster.
      server:
        url: "https://kubernetes.default.svc"

      # 2. A seção crucial que resolve o erro do webhook.
      #    Isto diz ao ESO para confiar no CA raiz do próprio cluster.
      caProvider:
        type: ConfigMap
        name: kube-root-ca.crt
        key: ca.crt
        # É uma boa prática especificar o namespace onde o ESO está instalado.
        namespace: external-secrets

      # 3. A forma de autenticação, usando a ServiceAccount do próprio ESO.
      auth:
        serviceAccount: 
          name: external-secrets-operator
          namespace: external-secrets
